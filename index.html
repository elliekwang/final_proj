<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guide to Planting Airbnbs in San Diego</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        .section {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: white;
            position: relative; /* Ensure each section is a positioned ancestor */
        }
        #section1, #section2, #section3, #section4, #section5, #section6, #section7 {
            background-color: #d1c9cc;
        }
        svg {
            max-width: 100%;
            width: 100%;
            height: 100%;
        }

        #map { 
            width: 30%; /* Adjust this value to your preference */
            height: 40%; /* Make sure the map takes up full height */
            margin-left: 45%;
        }

        #mapn {
            width: 30%;
            height: 35%;
            margin-right: 55%;
            margin-top: 16%;
        }

        #my_dataviz{
            height: auto;
            width: auto;
            margin-right: -40%;
        }
        #datan {
            width: 30%;
            height: 30%;
            margin-right: 55%;
            margin-top: 13%;
        }
    

        .textbox {
            position: absolute;
            top: 50px;
            right: 50px;
            width: 300px;
            background-color: rgba(238, 151, 151, 0.725);
            color: black;
            padding: 20px;
            border: 1px solid #cccccc00;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
            font-size: 16px;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            width: auto;
            height: auto;
            padding: 10px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
        }
        #intro-text {
            color: black;
            font-size: 16px;
            max-width: 800px;
        }
        #intro-title {
            font-size: 40px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        #intro_title {
            color: black;
            font-size: 28px;
            text-align: center;
            position: absolute;
            padding-bottom: 500px;
            padding-left: 650px;
        }
        #intro-subtitle {
            font-size: 20px;
            margin-bottom: 20px;
        }
    </style>
    <!-- Load d3.js and Leaflet.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <script src="./dataset.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
</head>
<body>

<!-- Creating the SECTIONS -->

    <!-- Section 1 -->
    <div id="section1" class="section">
        <div id="intro-text">
            <div id="intro-title">Guide to Planting Airbnbs in San Diego, CA Based on Geospatial Analysis of Host and Guest Patterns</div>
            <div id="intro-subtitle">Data collected from <a href="https://insideairbnb.com/get-the-data/" target="_blank">Inside Airbnb</a></div>
            <p>By: Ellie Wang, David Tsukamoto, Hannah Lee</p>
            <p>In 2023, Airbnb's revenue surged by 19.2% to $9.9 billion, with bookings increasing by 13.9%. Capitalize on this booming rental market through strategic pricing and location. This guide will help you navigate the San Diego Airbnb landscape to maximize your rental income.</p>
        </div>
    </div>

    <!-- Section 2 -->
     <!-- Section 2 -->
    <div id="section2" class="section">
        <div id= "intro_title">
            <p> Mapping of San Diego's Airbnb Listings  </p>
        </div>
        <div id="map"></div>
        <div class="textbox" id="mapn">
            <p>San Diego's Airbnb market is thriving and diverse, with properties scattered across the city.</p>
            <p>Using this map, we are able to recognize that the neighborhoods that are most populated with Airbnbs fall in close proximity to beaches as well as known tourist areas. Whether it's the beach vibes of Pacific Beach or the cultural charm of North Park, understanding which areas are popular and why can help you position your property to attract more bookings. 
            </p>
            <p>Tailor your offerings to the unique appeals of these hotspots, whether it's proximity to attractions, vibrant nightlife, or serene beach escapes.</p>
        </div>
    </div>
  

    <!-- Section 3 -->
    <div id="section3" class="section">
        <div class="textbox">
            <p>Did you know that just the top 10 neighborhoods account for a staggering 56% of all Airbnb listings in San Diego's 101 neighborhoods?</p>
            <p>While some neighborhoods in San Diego are saturated with Airbnb properties, others have relatively few listings. Understanding the distribution of listings can help you strategically place your property where the demand is highest and take advantage of the most popular areas. 
            </p>
    
            <p> With the information presented thus far, as a planter, you can research Airbnbs in these popular areas to further figure out what is a typical reasonable price to list your Airbnb, what amenities you could offer, what are the most popular property types, etc. 
            </p>
        </div>
        <svg id="barchart" width="1200" height="800"></svg>
    </div>

    <!-- Section 4 -->
    <div id="section4" class="section">
        <div id="my_dataviz"></div>
        <div class="textbox" id="datan">
            <p> Picture the joy of fully booked months and the peace of knowing youâ€™ve priced your listing perfectly. Use this data to experience the satisfaction of a well-planned hosting strategy.
            </p>
            <p> To be a well-performing and competitive rental, you must not only consider location but also understand the way Airbnb booking patterns vary throughout the year. This heat map illustrates the monthly availability of Airbnbs in the top 10 neighborhoods, showing peak seasons, such as the summer months, and quieter periods, which constitute the earlier months of the year. By understanding these trends, hosts can adjust their pricing strategies and optimize their listing times to maximize occupancy rates. </p>

            <p>

            </p>
        </div>
    </div>

    </div>

    <script>

        // Section #2 - Map
        console.log(jsdata)
        var map = L.map('map', {preferCanvas: true}).setView([32.8283, -117.1074], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',
            maxZoom: 14,
            minZoom: 12,
        }).addTo(map);


        jsdata.forEach(location => {
            var circle = L.circle([location.latitude, location.longitude], {
                color: '#c84779',
                opacity: 0.5 ,
                radius: 1
            }).addTo(map);
        });

        // Section #3 - Bar Chart
        var marginBar = {top: 50, right: 70, bottom: 200, left: 60},
            widthBar = 1100 - marginBar.left - marginBar.right,
            heightBar = 800 - marginBar.top - marginBar.bottom;

        var svgBar = d3.select("#barchart")
        .append("g")
            .attr("transform", "translate(" + marginBar.left + "," + marginBar.top + ")");

        var tooltipBar = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        var dataLoaded = false;

        function drawChart() {
            d3.csv("https://raw.githubusercontent.com/elliekwang/final_proj/main/neighbourhood_count.csv", function(data) {

                // X-axis
                var x = d3.scaleBand()
                .range([ 0, widthBar ])
                .domain(data.map(function(d) { return d.neighbourhood; }))
                .padding(0.2);
                svgBar.append("g")
                .attr("transform", "translate(0," + heightBar + ")")
                .call(d3.axisBottom(x))
                .selectAll("text")
                    .attr("transform", "translate(0,10)rotate(-90)")
                    .style("text-anchor", "end");

                // Y-axis
                var y = d3.scaleLinear()
                .domain([0, d3.max(data, function(d) { return +d.id; })])
                .range([ heightBar, 0]);
                svgBar.append("g")
                .call(d3.axisLeft(y));



                
                svgBar.selectAll("mybar")
                .data(data)
                .enter()
                .append("rect")
                .attr("x", function(d) { return x(d.neighbourhood); })
                .attr("width", x.bandwidth())
                .attr("fill", function(d, i) {
                    return i < 10 ? "#F42A73" : "#F885AF";
                })
                .attr("height", function(d) { return heightBar - y(0); })
                .attr("y", function(d) { return y(0); })
                .on("mouseover", function(d) {
                    tooltipBar.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltipBar.html("Neighborhood: " + d.neighbourhood + "<br/>Airbnb Count: " + d.id)
                        .style("left", (d3.event.pageX + 5) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    tooltipBar.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

            // Animation
            svgBar.selectAll("rect")
                .transition()
                .duration(800)
                .attr("y", function(d) { return y(d.id); })
                .attr("height", function(d) { return heightBar - y(d.id); })
                .delay(function(d,i){ return(i*100); });


                // Title
                svgBar.append("text")
                    .attr("x", (widthBar / 2))             
                    .attr("y", 0 - (marginBar.top / 2))
                    .attr("text-anchor", "middle")  
                    .style("font-size", "28px")
                    .text("Distribution of Airbnbs Across Neighborhoods in San Diego");


                // Subtitle
                var subtitleText = [
                    "This bar chart breaks down the number of Airbnbs in each neighborhood,",
                    "revealing neighborhoods with high activity and high competition."
                ];

                subtitleText.forEach(function(line, i) {
                    svgBar.append("text")
                        .attr("x", (widthBar / 2))
                        .attr("y", (30 + i * 20) - (marginBar.top / 2)) // Adjust the y value for line spacing
                        .attr("text-anchor", "middle")
                        .style("font-size", "18px")
                        .style("fill", "grey")
                        .text(line);
                });

                // x-axis label
                svgBar.append("text")
                    .attr("x", (widthBar / 2))
                    .attr("y", heightBar + marginBar.bottom - 40)
                    .attr("text-anchor", "middle")
                    .style("font-size", "16px")
                    .text("Neighborhood");

                // y-axis label
                svgBar.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - marginBar.left)
                    .attr("x", 0 - (heightBar / 2))
                    .attr("dy", "1em")
                    .attr("text-anchor", "middle")
                    .style("font-size", "16px")
                    .text("Count");
            });
        }

        // intersection observer
        var observer = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
                if (entry.isIntersecting && !dataLoaded) {
                    dataLoaded = true;
                    drawChart();
                }
            });
        }, { threshold: 0.5 });

        observer.observe(document.querySelector('#section3'));
        </script>

        <!-- Section #4 - Heatmap -->
        <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
        <script>
        var marginHeatmap = {top: 80, right: 25, bottom: 30, left: 140},
            widthHeatmap = 600 - marginHeatmap.left - marginHeatmap.right,
            heightHeatmap = 450 - marginHeatmap.top - marginHeatmap.bottom;


        var svgHeatmap = d3.select("#my_dataviz")
            .append("svg")
            .attr("width", widthHeatmap + marginHeatmap.left + marginHeatmap.right)
            .attr("height", heightHeatmap + marginHeatmap.top + marginHeatmap.bottom)
            .append("g")
            .attr("transform",
                "translate(" + marginHeatmap.left + "," + marginHeatmap.top + ")");

        d3.csv("https://raw.githubusercontent.com/elliekwang/final_proj/main/heatmap_data.csv", function(data) {

            // labels
            var myGroups = d3.map(data, function(d){return d.group;}).keys()
            var myVars = d3.map(data, function(d){return d.variable;}).keys()

            // x
            var xHeatmap = d3.scaleBand()
                .range([ 0, widthHeatmap ])
                .domain(myGroups)
                .padding(0.05);
            svgHeatmap.append("g")
                .style("font-size", 15)
                .attr("transform", "translate(0," + heightHeatmap + ")")
                .call(d3.axisBottom(xHeatmap).tickSize(0))
                .select(".domain").remove()

            // y
            var yHeatmap = d3.scaleBand()
                .range([ heightHeatmap, 0 ])
                .domain(myVars)
                .padding(0.05);
            svgHeatmap.append("g")
                .style("font-size", 15)
                .call(d3.axisLeft(yHeatmap).tickSize(0))
                .select(".domain").remove()

            // color scale
            var myColor = d3.scaleSequential()
                .interpolator(d => d3.interpolateInferno(1 - d))
                .domain([1, 100]);

            // tooltip
            var tooltip = d3.select("body")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "2px")
                .style("border-radius", "5px")
                .style("padding", "5px");

            // tooltip functions
            var mouseover = function(d) {
                tooltip.style("opacity", 1);
            };
            var mousemove = function(d) {
                tooltip
                    .html("There is an average of " + d.value + " Airbnbs booked in this neighborhood for this month." )
                    .style("left", (d3.event.pageX + 10) + "px")  // Position the tooltip to the right of the mouse pointer
                    .style("top", (d3.event.pageY - 10) + "px"); // Position the tooltip slightly above the mouse pointer
            };
            var mouseleave = function(d) {
                tooltip.style("opacity", 0);
            };

            // squares
            svgHeatmap.selectAll()
                .data(data, function(d) { return d.group + ':' + d.variable; })
                .enter()
                .append("rect")
                .attr("x", function(d) { return xHeatmap(d.group); })
                .attr("y", function(d) { return yHeatmap(d.variable); })
                .attr("rx", 4)
                .attr("ry", 4)
                .attr("width", xHeatmap.bandwidth())
                .attr("height", yHeatmap.bandwidth())
                .style("fill", function(d) { return myColor(d.value); })
                .style("stroke-width", 4)
                .style("stroke", "none")
                .style("opacity", 0.8)
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);
        })

        // title
        svgHeatmap.append("text")
                .attr("x", 0)
                .attr("y", -50)
                .attr("text-anchor", "left")
                .style("font-size", "28px")
                .text("Availability of Airbnbs Over the Year");


    
        var subtitle = [
            "This heatmap shows the number of booked Airbnbs over ",
            "the month in a year in the top 10 neighborhoods.",
        ];

        // subtitle
        subtitle.forEach(function(line, i) {
            svgHeatmap.append("text")
                .attr("x", 0)
                .attr("y", -25 + i * 20)  // Adjust the y position for each line
                .attr("text-anchor", "left")
                .style("font-size", "18px")
                .style("fill", "grey")
                .style("max-width", 400)
                .text(line);
        });
    </script>

</body>
</html>




