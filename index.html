<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guide to Planting Airbnbs in San Diego</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        .section {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: white;
            position: relative; /* Ensure each section is a positioned ancestor */
        }
        #section1, #section2, #section3, #section4, #section5, #section6, #section7 {
            background-color: #d1c9cc;
        }
        svg {
            max-width: 100%;
            height: auto;
        }
        #map { 
            height: 600px; 
            width: 800px;
        }
        .textbox {
            position: absolute;
            top: 50px;
            right: 50px;
            width: 300px;
            background-color: rgba(238, 151, 151, 0.725);
            color: black;
            padding: 20px;
            border: 1px solid #cccccc00;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
            font-size: 16px;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            width: auto;
            height: auto;
            padding: 10px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
        }
        #intro-text {
            color: black;
            font-size: 16px;
            max-width: 800px;
        }
        #intro-title {
            font-size: 40px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        #intro-subtitle {
            font-size: 20px;
            margin-bottom: 20px;
        }
    </style>
    <!-- Load d3.js and Leaflet.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <script src="./dataset.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
</head>
<body>

<!-- Creating the SECTIONS -->

    <!-- Section 1 -->
    <div id="section1" class="section">
        <div id="intro-text">
            <div id="intro-title">Guide to Planting Airbnbs in San Diego, CA Based on Geospatial Analysis of Host and Guest Patterns</div>
            <div id="intro-subtitle">Data collected from <a href="https://insideairbnb.com/get-the-data/" target="_blank">Inside Airbnb</a></div>
            <p>By: Ellie Wang, David Tsukamoto, Hannah Lee</p>
            <p>This visualization analyzes key trends and patterns in San Diego's most popular Airbnb neighborhoods. By examining host and guest behaviors, it provides insights and recommendations through the visualizations for prospective Airbnb hosts. The goal is to help new hosts strategically position and manage their rentals to maximize appeal and profitability in the competitive San Diego market.</p>
        </div>
    </div>

    <!-- Section 2 -->
    <div id="section2" class="section">
        <div id="map"></div>
    </div>

    <!-- Section 3 -->
    <div id="section3" class="section">
        <div class="textbox">
            <p>This bar chart shows the distribution of Airbnbs across various neighborhoods in San Diego. Each bar represents the count of Airbnbs in a particular neighborhood. From the chart, we are able to see that the ten most populated neighborhoods are: </p>
            <ol>
                <li>Mission Bay</li>
                <li>Pacific Beach</li>
                <li>La Jolla</li>
                <li>Ocean Beach</li>
                <li>North Hills</li>
                <li>East Village</li>
                <li>Midtown</li>
                <li>Loma Portal</li>
                <li>Gaslamp Quarter</li>
                <li>Balboa Park</li>
            </ol>
        </div>
        <svg id="barchart" width="1200" height="800"></svg>
    </div>

    <!-- Section 4 -->
    <div id="section4" class="section">
        <div id="my_dataviz"></div>
    </div>

    <!-- Section 5 -->
    <div id="section5" class="section">
        <div id="section5-content">
            <p>Additional insights and recommendations based on the data visualizations presented above.</p>
        </div>
    </div>

    <!-- Section 6 -->
    <div id="section6" class="section">
        <div id="section6-content">
            <p>This section can be used to discuss the economic impact of Airbnb in San Diego, highlighting the benefits and challenges faced by local communities.</p>
        </div>
    </div>

    <!-- Section 7 -->
    <div id="section7" class="section">
        <div id="section7-content">
            <p>This section can provide information on regulatory considerations and compliance requirements for Airbnb hosts in San Diego, offering guidance on how to stay within legal boundaries while maximizing profitability.</p>
        </div>
    </div>

    <script>

        // Section #2 - Map
        console.log(jsdata)
        var map = L.map('map', {preferCanvas: true}).setView([32.8283, -117.1074], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',
            maxZoom: 14,
            minZoom: 12,
        }).addTo(map);


        jsdata.forEach(location => {
            var circle = L.circle([location.latitude, location.longitude], {
                color: '#c84779',
                opacity: 0.5 ,
                radius: 1
            }).addTo(map);
        });

        // Section #3 - Bar Chart
        var marginBar = {top: 50, right: 70, bottom: 200, left: 60},
            widthBar = 1100 - marginBar.left - marginBar.right,
            heightBar = 800 - marginBar.top - marginBar.bottom;

        var svgBar = d3.select("#barchart")
        .append("g")
            .attr("transform", "translate(" + marginBar.left + "," + marginBar.top + ")");

        var tooltipBar = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        var dataLoaded = false;

        function drawChart() {
            d3.csv("https://raw.githubusercontent.com/elliekwang/final_proj/main/neighbourhood_count.csv", function(data) {

                // X-axis
                var x = d3.scaleBand()
                .range([ 0, widthBar ])
                .domain(data.map(function(d) { return d.neighbourhood; }))
                .padding(0.2);
                svgBar.append("g")
                .attr("transform", "translate(0," + heightBar + ")")
                .call(d3.axisBottom(x))
                .selectAll("text")
                    .attr("transform", "translate(0,10)rotate(-90)")
                    .style("text-anchor", "end");

                // Y-axis
                var y = d3.scaleLinear()
                .domain([0, d3.max(data, function(d) { return +d.id; })])
                .range([ heightBar, 0]);
                svgBar.append("g")
                .call(d3.axisLeft(y));

                // Bars
                svgBar.selectAll("mybar")
                .data(data)
                .enter()
                .append("rect")
                    .attr("x", function(d) { return x(d.neighbourhood); })
                    .attr("width", x.bandwidth())
                    .attr("fill", "#f76583")
                    .attr("height", function(d) { return heightBar - y(0); })
                    .attr("y", function(d) { return y(0); })
                    .on("mouseover", function(d) {
                        tooltipBar.transition()
                            .duration(200)
                            .style("opacity", .9);
                        tooltipBar.html("Neighborhood: " + d.neighbourhood + "<br/>Airbnb Count: " + d.id)
                            .style("left", (d3.event.pageX + 5) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                    })
                    .on("mouseout", function(d) {
                        tooltipBar.transition()
                            .duration(500)
                            .style("opacity", 0);
                    });

                // Animation
                svgBar.selectAll("rect")
                .transition()
                .duration(800)
                .attr("y", function(d) { return y(d.id); })
                .attr("height", function(d) { return heightBar - y(d.id); })
                .delay(function(d,i){ return(i*100); });

                // Title
                svgBar.append("text")
                    .attr("x", (widthBar / 2))             
                    .attr("y", 0 - (marginBar.top / 2))
                    .attr("text-anchor", "middle")  
                    .style("font-size", "24px") 
                    .style("text-decoration", "underline")  
                    .text("Distribution of Airbnbs Across Neighborhoods in San Diego");

                // x-axis label
                svgBar.append("text")
                    .attr("x", (widthBar / 2))
                    .attr("y", heightBar + marginBar.bottom - 40)
                    .attr("text-anchor", "middle")
                    .style("font-size", "16px")
                    .text("Neighborhood");

                // y-axis label
                svgBar.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - marginBar.left)
                    .attr("x", 0 - (heightBar / 2))
                    .attr("dy", "1em")
                    .attr("text-anchor", "middle")
                    .style("font-size", "16px")
                    .text("Count");
            });
        }

        // Intersection Observer to trigger animation on scroll
        var observer = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
                if (entry.isIntersecting && !dataLoaded) {
                    dataLoaded = true;
                    drawChart();
                }
            });
        }, { threshold: 0.5 });

        observer.observe(document.querySelector('#section3'));
        </script>

        <!-- Section #4 - Heatmap -->
        <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
        <script>
        var marginHeatmap = {top: 80, right: 25, bottom: 30, left: 140},
            widthHeatmap = 600 - marginHeatmap.left - marginHeatmap.right,
            heightHeatmap = 450 - marginHeatmap.top - marginHeatmap.bottom;


        var svgHeatmap = d3.select("#my_dataviz")
            .append("svg")
            .attr("width", widthHeatmap + marginHeatmap.left + marginHeatmap.right)
            .attr("height", heightHeatmap + marginHeatmap.top + marginHeatmap.bottom)
            .append("g")
            .attr("transform",
                "translate(" + marginHeatmap.left + "," + marginHeatmap.top + ")");

        // Read the data
        d3.csv("https://raw.githubusercontent.com/elliekwang/final_proj/main/heatmap.csv", function(data) {

            // Labels of row and columns -> unique identifier of the column called 'group' and 'variable'
            var myGroups = d3.map(data, function(d){return d.group;}).keys()
            var myVars = d3.map(data, function(d){return d.variable;}).keys()

            // Build X scales and axis:
            var xHeatmap = d3.scaleBand()
                .range([ 0, widthHeatmap ])
                .domain(myGroups)
                .padding(0.05);
            svgHeatmap.append("g")
                .style("font-size", 15)
                .attr("transform", "translate(0," + heightHeatmap + ")")
                .call(d3.axisBottom(xHeatmap).tickSize(0))
                .select(".domain").remove()

            // Build Y scales and axis:
            var yHeatmap = d3.scaleBand()
                .range([ heightHeatmap, 0 ])
                .domain(myVars)
                .padding(0.05);
            svgHeatmap.append("g")
                .style("font-size", 15)
                .call(d3.axisLeft(yHeatmap).tickSize(0))
                .select(".domain").remove()

            // Build color scale
            var myColor = d3.scaleSequential()
                .interpolator(d3.interpolateInferno)
                .domain([1,100])

            // create a tooltip
            var tooltipHeatmap = d3.select("#my_dataviz")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "2px")
                .style("border-radius", "5px")
                .style("padding", "5px")

            // Three function that change the tooltip when user hover / move / leave a cell
            var mouseover = function(d) {
                tooltip.style("opacity", 1)
            }
            var mousemove = function(d) {
                tooltip
                .html("The exact value of<br>this cell is: " + d.value)
                .style("left", (d3.mouse(this)[0]+70) + "px")
                .style("top", (d3.mouse(this)[1]) + "px")
            }
            var mouseleave = function(d) {
                tooltip.style("opacity", 0)
            }

            // add the squares
            svgHeatmap.selectAll()
                .data(data, function(d) {return d.group+':'+d.variable;})
                .enter()
                .append("rect")
                .attr("x", function(d) { return xHeatmap(d.group) })
                .attr("y", function(d) { return yHeatmap(d.variable) })
                .attr("rx", 4)
                .attr("ry", 4)
                .attr("width", xHeatmap.bandwidth() )
                .attr("height", yHeatmap.bandwidth() )
                .style("fill", function(d) { return myColor(d.value)} )
                .style("stroke-width", 4)
                .style("stroke", "none")
                .style("opacity", 0.8)
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)
        })

        // Add title to graph
        svgHeatmap.append("text")
                .attr("x", 0)
                .attr("y", -50)
                .attr("text-anchor", "left")
                .style("font-size", "22px")
                .text("Availability of Airbnbs Over the Year");


    
        var subtitle = [
            "This heatmap shows the number of booked Airbnbs over the months",
            "in a year in the top 10 neighborhoods.",
        ];

        // Add subtitle to graph
        subtitle.forEach(function(line, i) {
            svgHeatmap.append("text")
                .attr("x", 0)
                .attr("y", -20 + i * 15)  // Adjust the y position for each line
                .attr("text-anchor", "left")
                .style("font-size", "14px")
                .style("fill", "grey")
                .style("max-width", 400)
                .text(line);
        });
    </script>

</body>
</html>




