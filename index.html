<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoJSON Map with D3.js and Scrollytelling</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        .section {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: white;
            transition: background-color 0.5s;
        }
        #section1 {
            background-color: #3498db;
        }
        #section2 {
            background-color: #2ecc71;
        }
        #section3 {
            background-color: #e74c3c;
        }
        svg {
            max-width: 100%;
            height: auto;
        }
    </style>
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
</head>
<body>
    <div id="section1" class="section">
        <p>Welcome to Page 1</p>
    </div>
    <div id="section2" class="section">
        <svg id="my_dataviz" width="800" height="600"></svg>
    </div>
    <div id="section3" class="section">
        <div id="my_dataviz_bar"></div>
    </div>

    <script>
        // The svg for the map
        var svgMap = d3.select("#my_dataviz"),
            width = +svgMap.attr("width"),
            height = +svgMap.attr("height");

        // Map and projection
        var projection = d3.geoMercator()
            .center([-117, 32])                // Center of your data
            .scale(50000)                      // Adjust scale based on your data
            .translate([ width / 2, height / 2 ]);

        // Path generator
        var path = d3.geoPath().projection(projection);

        // Load external data and boot
        d3.json("https://raw.githubusercontent.com/elliekwang/final_proj/main/neighbourhoods.geojson", function(error, data) {
            if (error) throw error;

            // Draw the map
            svgMap.append("g")
                .selectAll("path")
                .data(data.features)
                .enter()
                .append("path")
                  .attr("fill", "#69b3a2")
                  .attr("d", path)
                  .style("stroke", "#fff");

            // Optionally, you can add labels
            svgMap.append("g")
                .selectAll("text")
                .data(data.features)
                .enter()
                .append("text")
                  .attr("x", function(d) { return path.centroid(d)[0]; })
                  .attr("y", function(d) { return path.centroid(d)[1]; })
                  .attr("text-anchor", "middle")
                  .style("fill", "black")
                  .style("font-size", "12px")
                  .text(function(d) { return d.properties.name; });
        });

        // Bar chart code for the third section
        // set the dimensions and margins of the graph
        var margin = {top: 10, right: 30, bottom: 90, left: 40},
            widthBar = 460 - margin.left - margin.right,
            heightBar = 450 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        var svgBar = d3.select("#my_dataviz_bar")
          .append("svg")
            .attr("width", widthBar + margin.left + margin.right)
            .attr("height", heightBar + margin.top + margin.bottom)
          .append("g")
            .attr("transform",
                  "translate(" + margin.left + "," + margin.top + ")");

        // Function to run the bar chart animation
        function runBarChartAnimation() {
            // Remove existing bars
            svgBar.selectAll("rect").remove();

            // Parse the Data
            d3.csv("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/7_OneCatOneNum_header.csv", function(data) {
                // X axis
                var x = d3.scaleBand()
                  .range([ 0, widthBar ])
                  .domain(data.map(function(d) { return d.Country; }))
                  .padding(0.2);
                svgBar.append("g")
                  .attr("transform", "translate(0," + heightBar + ")")
                  .call(d3.axisBottom(x))
                  .selectAll("text")
                    .attr("transform", "translate(-10,0)rotate(-45)")
                    .style("text-anchor", "end");

                // Add Y axis
                var y = d3.scaleLinear()
                  .domain([0, 13000])
                  .range([ heightBar, 0]);
                svgBar.append("g")
                  .call(d3.axisLeft(y));

                // Bars
                svgBar.selectAll("mybar")
                  .data(data)
                  .enter()
                  .append("rect")
                    .attr("x", function(d) { return x(d.Country); })
                    .attr("width", x.bandwidth())
                    .attr("fill", "#69b3a2")
                    // no bar at the beginning thus:
                    .attr("height", function(d) { return heightBar - y(0); }) // always equal to 0
                    .attr("y", function(d) { return y(0); })

                // Animation
                svgBar.selectAll("rect")
                  .transition()
                  .duration(800)
                  .attr("y", function(d) { return y(d.Value); })
                  .attr("height", function(d) { return heightBar - y(d.Value); })
                  .delay(function(d,i){console.log(i) ; return(i*100)});
            });
        }

        // Initial call to run the bar chart animation
        runBarChartAnimation();

        // Set interval to reload the animation every 10 seconds
        setInterval(runBarChartAnimation, 10000);

        // Scrollytelling: Change background colors on scroll
        window.addEventListener('scroll', function() {
            var sections = document.querySelectorAll('.section');
            var scrollPos = window.scrollY || document.documentElement.scrollTop;

            sections.forEach(function(section) {
                if (section.offsetTop <= scrollPos && (section.offsetTop + section.offsetHeight) > scrollPos) {
                    section.style.backgroundColor = getComputedStyle(section).getPropertyValue('background-color');
                } else {
                    section.style.backgroundColor = '';
                }
            });
        });
    </script>
</body>
</html>

