<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrollytelling Example with D3.js Map and Bar Chart</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        .section {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: white;
        }
        #section1 {
            background-color: #3498db;
        }
        #section2 {
            background-color: #2ecc71;
        }
        #section3 {
            background-color: #e74c3c;
        }
        svg {
            max-width: 100%;
            height: auto;
        }
    </style>
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
</head>
<body>
    <div id="section1" class="section">
        <p>Welcome to Page 1</p>
    </div>
    <div id="section2" class="section">
        <svg id="map" width="800" height="600"></svg>
    </div>
    <div id="section3" class="section">
        <svg id="barchart" width="800" height="600"></svg>
    </div>

    <script>
        // The svg for the map
        var svgMap = d3.select("#map"),
            widthMap = +svgMap.attr("width"),
            heightMap = +svgMap.attr("height");

        // Map and projection
        var projection = d3.geoNaturalEarth1()
            .scale(widthMap / 1.3 / Math.PI)
            .translate([widthMap / 2, heightMap / 2]);

        // Load external data and boot
        d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson", function(data) {
            // Draw the map
            svgMap.append("g")
                .selectAll("path")
                .data(data.features)
                .enter().append("path")
                    .attr("fill", "#69b3a2")
                    .attr("d", d3.geoPath().projection(projection))
                    .style("stroke", "#fff");
        });

        // The svg for the bar chart
        var margin = {top: 10, right: 30, bottom: 90, left: 40},
            width = 800 - margin.left - margin.right,
            height = 600 - margin.top - margin.bottom;

        var svgBar = d3.select("#barchart")
          .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        // Parse the Data
        d3.csv("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/7_OneCatOneNum_header.csv", function(data) {

            // X axis
            var x = d3.scaleBand()
              .range([ 0, width ])
              .domain(data.map(function(d) { return d.Country; }))
              .padding(0.2);
            svgBar.append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(x))
              .selectAll("text")
                .attr("transform", "translate(-10,0)rotate(-45)")
                .style("text-anchor", "end");

            // Add Y axis
            var y = d3.scaleLinear()
              .domain([0, 13000])
              .range([ height, 0]);
            svgBar.append("g")
              .call(d3.axisLeft(y));

            // Bars
            svgBar.selectAll("mybar")
              .data(data)
              .enter()
              .append("rect")
                .attr("x", function(d) { return x(d.Country); })
                .attr("width", x.bandwidth())
                .attr("fill", "#69b3a2")
                // no bar at the beginning thus:
                .attr("height", function(d) { return height - y(0); }) // always equal to 0
                .attr("y", function(d) { return y(0); });

            // Animation
            svgBar.selectAll("rect")
              .transition()
              .duration(800)
              .attr("y", function(d) { return y(d.Value); })
              .attr("height", function(d) { return height - y(d.Value); })
              .delay(function(d,i){ return(i*100); });
        });
    </script>
</body>
</html>


