<!DOCTYPE html>
<html lang="en">

<!-- Load Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrollytelling Example with D3.js Map and Bar Chart</title>
    <style>
        #map { height: 400px; width: 620px;}

        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        .section {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: white;
        }
        #section1 {
            background-color: #3498db;
        }
        #section2 {
            background-color: #2ecc71;
        }
        #section3 {
            background-color: #e74c3c;
        }
        svg {
            max-width: 100%;
            height: auto;
        }
    </style>
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
</head>
<body>
    <div id="section1" class="section">
        <p>Welcome to Page 1</p>
    </div>
    <div id="map"></div>

    <div id="section2" class="section">
        <svg id="map1" width="800" height="600"></svg>
    </div>
    <div id="section3" class="section">
        <svg id="barchart" width="800" height="600"></svg>
    </div>

    <script>
        // The svg for the map
        var svgMap = d3.select("#map1"),
            widthMap = +svgMap.attr("width"),
            heightMap = +svgMap.attr("height");

        // Map and projection
        var projection = d3.geoNaturalEarth1()
            .scale(widthMap / 1.3 / Math.PI)
            .translate([widthMap / 2, heightMap / 2]);

        // Load external data and boot
        d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson", function(data) {
            // Draw the map
            svgMap.append("g")
                .selectAll("path")
                .data(data.features)
                .enter().append("path")
                    .attr("fill", "#69b3a2")
                    .attr("d", d3.geoPath().projection(projection))
                    .style("stroke", "#fff");
        });

        // The svg for the bar chart
        var margin = {top: 10, right: 30, bottom: 90, left: 40},
            width = 800 - margin.left - margin.right,
            height = 600 - margin.top - margin.bottom;

        var svgBar = d3.select("#barchart")
          .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        // Parse the Data
        d3.csv("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/7_OneCatOneNum_header.csv", function(data) {

            // X axis
            var x = d3.scaleBand()
              .range([ 0, width ])
              .domain(data.map(function(d) { return d.Country; }))
              .padding(0.2);
            svgBar.append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(x))
              .selectAll("text")
                .attr("transform", "translate(-10,0)rotate(-45)")
                .style("text-anchor", "end");

            // Add Y axis
            var y = d3.scaleLinear()
              .domain([0, 13000])
              .range([ height, 0]);
            svgBar.append("g")
              .call(d3.axisLeft(y));

            // Bars
            svgBar.selectAll("mybar")
              .data(data)
              .enter()
              .append("rect")
                .attr("x", function(d) { return x(d.Country); })
                .attr("width", x.bandwidth())
                .attr("fill", "#69b3a2")
                // no bar at the beginning thus:
                .attr("height", function(d) { return height - y(0); }) // always equal to 0
                .attr("y", function(d) { return y(0); });

            // Animation
            svgBar.selectAll("rect")
              .transition()
              .duration(800)
              .attr("y", function(d) { return y(d.Value); })
              .attr("height", function(d) { return height - y(d.Value); })
              .delay(function(d,i){ return(i*100); });
        });
        // Initialize the map
        // [50, -0.1] are the latitude and longitude
        // 4 is the zoom
        // mapid is the id of the div where the map will appear
        
        var map = L.map('map').setView([32.8283, -117.1074], 10);
        
        // Add a tile to the map = a background. Comes from OpenStreetmap
        L.tileLayer(
            'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',
            maxZoom: 17,
            }).addTo(map);

        var zoo = {
            "type": "Feature",
            "properties": {
                "name": "San Diego Zoo",
                "amenity": "Zoo",
                "popupContent": "This is a zoo!"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [32.7349, -117.1490]
            }
        };

        L.geoJSON(zoo).addTo(map);

        let blc = L.marker([32.652989,-116.989716]).addTo(map);
        let elt = L.marker([32.638639,-116.954461]).addTo(map);
        let ag = L.marker([32.803846,-117.079464]).addTo(map);
        let dc = L.marker([32.781046,-117.083264]).addTo(map);
        let glq = L.marker([32.714928,-117.159273,]).addTo(map);

        blc.bindPopup("<b>Bonita Long Canyon Airbnb</b><br>").openPopup();
        elt.bindPopup("<b>Eastlake Trails Airbnb</b><br>").openPopup();
        ag.bindPopup("<b>Allied Gardens Airbnb</b><br>").openPopup();
        dc.bindPopup("<b>Del Cerro Airbnb</b><br>").openPopup();
        glq.bindPopup("<b>Gaslamp Quarter Airbnb</b><br>").openPopup();


    </script>
</body>
</html>


